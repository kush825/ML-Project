{% extends "base.html" %}

{% block title %}Predict Risk | CardioSense AI{% endblock %}

{% block content %}
<section class="py-5">
    <div class="container">
        <div class="row g-4 align-items-start">
            <div class="col-lg-4">
                <aside class="glass-card sticky-panel">
                    <span class="eyebrow"><i class="fa-solid fa-stethoscope"></i> Prediction Workspace</span>
                    <h3 class="mt-3 gradient-text">Bio-Metric Analysis</h3>
                    <p class="text-secondary mb-4">Our neural network evaluates 11 health indicators to estimate
                        cardiovascular risk with clinical precision.</p>

                    <div class="metric-card bg-glass mb-3">
                        <i class="fa-solid fa-shield-halved text-accent mb-2 d-block fs-4"></i>
                        <strong>Privacy First</strong>
                        <p class="small text-secondary mb-0">Local processing ensures your health data is never stored
                            on our servers.</p>
                    </div>
                </aside>
            </div>

            <div class="col-lg-8">
                <div class="glass-card p-4 p-lg-5">
                    <h4 class="mb-5 fw-bold">Clinical <span class="gradient-text">Parameters</span></h4>
                    <form id="predictionForm">
                        <h6 class="section-label">Demographics & Anthropometrics</h6>
                        <div class="row g-4 mb-5">
                            <div class="col-md-6">
                                <label for="age" class="form-label">Age (years)</label>
                                <input type="number" class="form-control" id="age" required min="10" max="100"
                                    placeholder="e.g. 45">
                            </div>
                            <div class="col-md-6">
                                <label for="gender" class="form-label">Gender</label>
                                <select class="form-select" id="gender" required>
                                    <option value="" selected disabled>Select...</option>
                                    <option value="2">Male</option>
                                    <option value="1">Female</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="height" class="form-label">Height (cm)</label>
                                <input type="number" class="form-control" id="height" required min="50" max="250"
                                    placeholder="e.g. 175">
                            </div>
                            <div class="col-md-6">
                                <label for="weight" class="form-label">Weight (kg)</label>
                                <input type="number" class="form-control" id="weight" required min="30" max="200"
                                    placeholder="e.g. 70">
                            </div>
                        </div>

                        <h6 class="section-label">Vitals & Laboratory Values</h6>
                        <div class="row g-4 mb-5">
                            <div class="col-md-6">
                                <label for="ap_hi" class="form-label">Systolic BP (mmHg)</label>
                                <input type="number" class="form-control" id="ap_hi" required placeholder="120" min="60"
                                    max="250">
                            </div>
                            <div class="col-md-6">
                                <label for="ap_lo" class="form-label">Diastolic BP (mmHg)</label>
                                <input type="number" class="form-control" id="ap_lo" required placeholder="80" min="40"
                                    max="150">
                            </div>
                            <div class="col-md-6">
                                <label for="cholesterol" class="form-label">Cholesterol Level</label>
                                <select class="form-select" id="cholesterol" required>
                                    <option value="1">Normal</option>
                                    <option value="2">Above Normal</option>
                                    <option value="3">Well Above Normal</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="gluc" class="form-label">Glucose Level</label>
                                <select class="form-select" id="gluc" required>
                                    <option value="1">Normal</option>
                                    <option value="2">Above Normal</option>
                                    <option value="3">Well Above Normal</option>
                                </select>
                            </div>
                        </div>

                        <h6 class="section-label">Lifestyle Factors</h6>
                        <div class="row g-3 mb-5">
                            <div class="col-md-4">
                                <label class="check-box-card">
                                    <input type="checkbox" id="smoke">
                                    <span>Smoker</span>
                                </label>
                            </div>
                            <div class="col-md-4">
                                <label class="check-box-card">
                                    <input type="checkbox" id="alco">
                                    <span>Alcohol Intake</span>
                                </label>
                            </div>
                            <div class="col-md-4">
                                <label class="check-box-card">
                                    <input type="checkbox" id="active" checked>
                                    <span>Physically Active</span>
                                </label>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-accent btn-lg w-100 py-3" id="predictBtn">
                            Analyze Risk Profile <i class="fa-solid fa-microchip ms-2"></i>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Result Modal -->
<div class="modal fade" id="resultModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0">
            <div class="modal-body text-center p-5">
                <div id="loadingSpinner" class="py-4">
                    <div class="spinner-border text-accent mb-3" style="width: 3rem; height: 3rem;" role="status"></div>
                    <h5 class="fw-bold">Running Simulation...</h5>
                    <p class="text-secondary">Ensemble models are processing clinical vectors.</p>
                </div>

                <div id="resultContent" class="d-none">
                    <div class="mb-4 d-inline-block p-4 rounded-circle bg-glass" id="iconContainer"></div>
                    <h2 class="fw-bold mb-3" id="resultTitle">Analysis Complete</h2>

                    <div class="mb-4 py-3 border-top border-bottom" id="scoreContainer">
                        <span class="text-secondary d-block small mb-1">Calculated Risk Index</span>
                        <div class="d-flex align-items-center justify-content-center gap-2">
                            <span class="h1 fw-bold mb-0" id="riskScore">--</span>
                            <span class="h4 text-secondary mb-0 mt-2">%</span>
                        </div>
                    </div>

                    <p class="lead mb-4 text-secondary" id="resultMessage">Message</p>

                    <div class="alert alert-warning border-0 rounded-4 text-start small mb-4 p-3 d-flex gap-3">
                        <i class="fa-solid fa-triangle-exclamation fs-4"></i>
                        <div>
                            <strong class="d-block mb-1">Medical Disclaimer</strong>
                            This automated assessment is for educational guidance only. Cardiovascular health requires
                            professional clinical diagnosis.
                        </div>
                    </div>

                    <div class="text-secondary small mb-4">
                        <i class="fa-solid fa-microchip me-1"></i> Model Overall Accuracy: <span
                            class="fw-bold">73.2%</span>
                    </div>

                    <button type="button" class="btn btn-outline-light rounded-pill px-5" data-bs-dismiss="modal">Close
                        Workspace</button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/script.js') }}"></script>
{% endblock %}